<!DOCTYPE html>
<html>

<head>
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.3/css/all.min.css"
        integrity="sha512-iBBXm8fW90+nuLcSKlbmrPcLa0OT92xO1BIsZ+ywDWZCvqsWgccV3gFoRBv0z+8dLJgyAHIhR35VZc2oM/gI1w=="
        crossorigin="anonymous" />
    <title>ARC</title>
    <link rel="stylesheet" href="/static/style.css">
</head>

<body>
    <header>
        <div class="header-content">
            <h1><a href="javascript:location.reload()">ARC</a></h1>
        </div>
    </header>
    <main>
        <section class="hero-shell">
            <div class="hero-content">
                <p class="eyebrow">ai radiology copilot</p>
                <h2>Support tool. Pre-screen only.</h2>
                <p class="hero-lede">Upload a brain MRI slice and ARC blends ResNet confidence with YOLO overlays to
                    suggest whether a tumor is present and, if so, which class is most likely.</p>
                <div class="hero-highlights">
                    <span class="highlight-chip">AI Model</span>
                    <span class="highlight-chip">ResNet probabilities</span>
                    <span class="highlight-chip">YOLO overlays</span>
                </div>
                <div class="hero-metrics">
                    <article>
                        <span class="metric-value">~32 ms</span>
                        <span class="metric-label">Avg. inference</span>
                    </article>
                    <article>
                        <span class="metric-value">4 classes</span>
                        <span class="metric-label">No tumor 路 Glioma 路 Meningioma 路 Pituitary</span>
                    </article>
                </div>
            </div>
            <div class="hero-panel card">
                <div class="card-header">
                    <div>
                        <h2>Scan Insight</h2>
                        <p class="card-subtitle">Drag & drop an MRI slice or browse manually.</p>
                    </div>
                    <p class="card-badge">IN DEVELOPMENT</p>
                </div>
                <form id="upload-form" method="post" enctype="multipart/form-data">
                    <div class="upload-dropzone">
                        <input type="file" name="file1" id="file1">
                        <label for="file1">
                            <span class="drop-main">Select or drop your image</span>
                            <span class="drop-sub">Max 25&nbsp;MB 路 PNG/JPG</span>
                        </label>
                    </div>
                    <button class="primary-action" type="submit" id="submit-button">Ask ARC</button>
                    <div id="selection-status" class="selection-status" aria-live="polite"></div>
                    <div id="alert" class="alert hidden" role="alert" aria-live="assertive">
                        <span id="alert-text"></span>
                        <button type="button" id="alert-close" class="alert-close" aria-label="Dismiss">&times;</button>
                    </div>
                </form>
                <div class="result-container">
                    <div class="prediction">
                        {% if prediction_made %}
                        {% if yolo %}
                        <img src="data:image/jpeg;base64,{{ annotated_image }}" />
                        {% endif %}
                        <p>IRMA predicts {{ prediction }} with {{ probability | round(2) }}% confidence</p>
                        {% endif %}
                    </div>
                </div>
            </div>
        </section>
    </main>
    <footer>
        <div class="social-links">
            <a href="https://gitlab.com/vin-br/arc"><i class="fab fa-gitlab" style="font-size: 2rem;"></i></a>
            <a href="https://www.linkedin.com/in/vin-br/"><i class="fab fa-linkedin" style="font-size: 2rem;"></i></a>
            <a href="https://www.mozilla.org/en-US/MPL/2.0/"><i class="fas fa-file-contract"
                    style="font-size: 2rem;"></i></a>
        </div>
        <p>Vincent Boettcher</p>
    </footer>
    <script>
        const form = document.getElementById('upload-form');
        const fileInput = document.getElementById('file1');
        const statusText = document.getElementById('selection-status');
        const alertBox = document.getElementById('alert');
        const alertText = document.getElementById('alert-text');
        const alertClose = document.getElementById('alert-close');

        let hideAlertTimeout;

        const hideAlert = () => {
            alertBox.classList.add('hidden');
        };

        const showAlert = (message, type = 'info') => {
            alertText.textContent = message;
            alertBox.classList.remove('hidden', 'alert--error', 'alert--info', 'alert--success');
            alertBox.classList.add(`alert--${type}`);
            clearTimeout(hideAlertTimeout);
            hideAlertTimeout = setTimeout(hideAlert, 5000);
        };

        alertClose.addEventListener('click', hideAlert);

        fileInput.addEventListener('change', () => {
            if (fileInput.files.length) {
                const [{ name }] = fileInput.files;
                statusText.textContent = `Selected: ${name}`;
                statusText.classList.add('selection-status--active');
                showAlert('Image selected. Predictions coming soon.', 'success');
            } else {
                statusText.textContent = '';
                statusText.classList.remove('selection-status--active');
                showAlert('Image selection cleared.', 'info');
            }
        });

        form.addEventListener('submit', (event) => {
            event.preventDefault();
            if (!fileInput.files.length) {
                showAlert('Please select an image before asking IRMA.', 'error');
                return;
            }
            showAlert('Prediction service is in maintenance.', 'info');
        });
    </script>
</body>

</html>